<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Test Frontend</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
      #chat {
        width: 300px;
        margin: 0 auto;
        text-align: center;
      }
      #messages {
        border: 1px solid #ccc;
        height: 200px;
        overflow-y: scroll;
        margin-bottom: 10px;
      }
      .message {
        padding: 5px;
        border-bottom: 1px solid #eee;
      }
      input {
        width: 80%;
        padding: 5px;
      }
      button {
        padding: 5px 10px;
      }
    </style>
  </head>
  <body>
    <div id="chat">
      <h1>Chat Room</h1>
      <div id="messages"></div>
      <input id="messageInput" placeholder="Enter message" />
      <button onclick="sendMessage()">Send</button>
      <button onclick="fetchPosts()">Fetch Posts</button>
    </div>

    <script>
      const socket = io('http://localhost:3000'); // 서버 주소에 맞게 변경

      socket.on('SEND_MESSAGE', (msg) => {
        const messagesDiv = document.getElementById('messages');
        const messageElement = document.createElement('div');
        messageElement.className = 'message';
        messageElement.textContent = `${msg.sender}: ${msg.content}`;
        messagesDiv.appendChild(messageElement);
      });

      function sendMessage() {
        const messageInput = document.getElementById('messageInput');
        const message = messageInput.value;
        const room = 'default'; // 테스트할 방 이름
        socket.emit('SEND_MESSAGE', JSON.stringify({ room, message }));
        messageInput.value = '';
      }

      // 방에 입장
      socket.emit('JOIN_ROOM', 'default');

      // API 통신: 게시글 가져오기
      async function fetchPosts() {
        try {
          const response = await fetch('http://localhost:3000/api/post');
          const posts = await response.json();
          console.log('Posts:', posts);
          alert('Posts fetched! Check console for details.');
        } catch (error) {
          console.error('Error fetching posts:', error);
        }
      }
    </script>
  </body>
</html>
